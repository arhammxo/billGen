<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Riz Billing</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="container">
        <div class="header" style="display: flex; flex-direction: column; align-items: center;">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Hotel Logo" class="logo">
            <h1>Hotel Riz Billing System</h1>
        </div>

        <form method="POST">
            <div class="input-group">
                <div class="input-item">
                    <label for="customer_name"><i class="fas fa-user"></i> Customer Name</label>
                    <input type="text" id="customer_name" name="customer_name" required placeholder="Enter customer name" value="{{ customer_name if customer_name else '' }}">
                </div>
            </div>

            <div class="input-group split">
                <div class="input-item">
                    <label for="room_type"><i class="fas fa-bed"></i> Room Type</label>
                    <select id="room_type" name="room_type" required>
                        <option value="Single" {% if room_type == 'Single' %}selected{% endif %}>Studio</option>
                        <option value="Double" {% if room_type == 'Double' %}selected{% endif %}>Double</option>
                        <option value="Suite" {% if room_type == 'Suite' %}selected{% endif %}>Deluxe</option>
                    </select>
                </div>
                <div class="input-item">
                    <label for="number_of_rooms"><i class="fas fa-door-open"></i> Rooms</label>
                    <input type="number" id="number_of_rooms" name="number_of_rooms" required min="1" value="{{ number_of_rooms if number_of_rooms else '1' }}">
                </div>
            </div>

            <div class="input-group">
                <div class="input-item">
                    <label for="bill_amount"><i class="fas fa-rupee-sign"></i> Bill Amount</label>
                    <input type="number" id="bill_amount" name="bill_amount" required placeholder="Enter total amount" value="{{ bill_amount if bill_amount else '' }}">
                </div>
            </div>

            <div class="input-group split">
                <div class="input-item">
                    <label for="check_in"><i class="fas fa-calendar-check"></i> Check-In Date</label>
                    <input type="date" id="check_in" name="check_in" required value="{{ check_in if check_in else '' }}" max="{{ today }}">
                </div>
                <div class="input-item">
                    <label for="check_out"><i class="fas fa-calendar-times"></i> Check-Out Date</label>
                    <input type="date" id="check_out" name="check_out" required value="{{ check_out if check_out else '' }}" max="{{ today }}">
                    <div class="error" id="dateError" style="display: none; margin-top: 0.5rem;">
                        <i class="fas fa-exclamation-triangle"></i> Check-out date cannot be before check-in date!
                    </div>
                </div>
            </div>

            <div class="input-group">
                <div class="input-item">
                    <label for="corporate_gst"><i class="fas fa-building"></i> Corporate GSTIN (optional)</label>
                    <input type="text" id="corporate_gst" name="corporate_gst" pattern="\d{2}[A-Z]{5}\d{4}[A-Z]{1}\d[Z]{1}[A-Z\d]{1}" placeholder="GSTIN format: 07ABCDE1234F1Z5" value="{{ corporate_gst if corporate_gst else '' }}">
                </div>
            </div>

            <button type="submit" class="submit-btn">
                <i class="fas fa-file-invoice-dollar"></i> Generate Bill
            </button>
        </form>

        {% if pdf_filename %}
        <div class="generated-bill">
            <h3>Generated Bill</h3>
            <div class="bill-detail">
                <span>Bill Number:</span> <strong>{{ bill_number }}</strong>
            </div>
            <div class="bill-detail">
                <span>Customer Name:</span> <strong>{{ customer_name }}</strong>
            </div>
            <div class="bill-detail">
                <span>Room Type:</span> <strong>{{ room_type }}</strong>
            </div>
            <div class="bill-detail">
                <span>Number of Rooms:</span> <strong>{{ number_of_rooms }}</strong>
            </div>
            <div class="bill-detail">
                <span>Check-In Date:</span> <strong>{{ check_in }}</strong>
            </div>
            <div class="bill-detail">
                <span>Check-Out Date:</span> <strong>{{ check_out }}</strong>
            </div>
            <div class="bill-detail">
                <span>Bill Amount:</span> <strong>₹{{ bill_amount }}</strong>
            </div>
            <div class="bill-detail">
                <span>GST (6%):</span> <strong>₹{{ gst }}</strong>
            </div>
            <div class="bill-detail">
                <span>Tax (6%):</span> <strong>₹{{ tax }}</strong>
            </div>
            <div class="bill-detail">
                <span>Corporate GSTIN:</span> <strong>{{ corporate_gst if corporate_gst else 'N/A' }}</strong>
            </div>
            <div class="bill-detail">
                <span>Total Amount:</span> <strong>₹{{ total_amount }}</strong>
            </div>
            
            <a href="{{ url_for('static', filename='bills/' + pdf_filename.split('/')[-1]) }}" target="_blank" class="download-btn">
                Download PDF Bill
            </a>
        </div>
        {% endif %}
    </div>

    <script>
        // Add date validation
        const checkIn = document.getElementById('check_in');
        const checkOut = document.getElementById('check_out');
        const dateError = document.getElementById('dateError');

        function validateDates() {
            const checkInDate = new Date(checkIn.value);
            const checkOutDate = new Date(checkOut.value);
            
            if (checkOutDate < checkInDate) {
                dateError.style.display = 'block';
            } else {
                dateError.style.display = 'none';
            }
        }

        checkIn.addEventListener('change', validateDates);
        checkOut.addEventListener('change', validateDates);
    </script>
</body>
</html>
